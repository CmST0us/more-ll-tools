## snowcone

As far as I know, the only dependencies are

- requests
- Pillow
- plac

A requirements.txt is not provided because I'm not currently
running these in a virtualenv

### Global config (applies to all tools)

Copy the following into `config.py` and fill in the blanks.

```python
SUKUTOMO_URL = "https://schoolido.lu"
SUKUTOMO_CLIENT_ID = "__OAuth_consumer_key__"
SUKUTOMO_CLIENT_SECRET = "__OAuth_consumer_secret__"
TINYPNG_API_KEY = "_____________________"

SUKUTOMO_UID = "____________________"
SUKUTOMO_PASSWORD = "____________________"
SUKUTOMO_TOKEN = None
```

Tokens expire after a while so you should specify the password if
you plan to run it non-interactively.

### Running the tools

**Please read the caveats section before running any of the tools.**

`python3 seed_from_live.py xxx.db`

Pull image status from schoolido.lu. Note that this marks everything
inconsistent but doesn't perform consistency checks, so you should run
`gen_images` after to correct the DB (or upload images).

---------

`python3 gen_images.py path_to_ecache xxx.db`

Check the status of all sync entries marked inconsistent, and
generate/patch images if needed.

------

`python3 gen_basic_data.py path_to_unit.db_ [xxx.db]`

Upload basic data entries for cards that do not exist. If the
second parameter is passed, blank image status entries will be written to
the sync db for each new card.

If you don't give `gen_basic_data` a sync db, you'll need to run
`seed_from_live` later to create the new entries (slow).

-----

`python3 verify_basic_data.py path_to_unit.db_ [yes]`

Check all card objects against those in `unit.db_`, and patch
them to correct values if needed.

### Basic data

For the purposes of `gen_basic_data` and `verify_basic_data`, the following keys are considered "basic data":

| key                                     | type |                                                                       |
| --------------------------------------- | ---- | --------------------------------------------------------------------- |
| `attribute`                             | str  |                                                                       |
| `game_id`                               | int  | internal master/KLab id                                               |
| `hp`                                    | int  | 0 for special cards                                                   |
| `id`                                    | int  | card ordinal, not to be confused with `game_id`                       |
| `idol`                                  | str  | not verified                                                          |
| `idolized_maximum_statistics_cool`      | int  | 0 for special cards                                                   |
| `idolized_maximum_statistics_pure`      | int  | "                                                                     |
| `idolized_maximum_statistics_smile`     | int  | "                                                                     |
| `is_promo`                              | bool |                                                                       |
| `is_special`                            | bool | YES for trainer cards                                                 |
| `japanese_skill`                        | str  |                                                                       |
| `minimum_statistics_cool`               | int  | 0 for special cards                                                   |
| `minimum_statistics_pure`               | int  | "                                                                     |
| `minimum_statistics_smile`              | int  | "                                                                     |
| `name`                                  | str  | not verified                                                          |
| `non_idolized_maximum_statistics_cool`  | int  | 0 for pre-transformed, N, and special cards                           |
| `non_idolized_maximum_statistics_pure`  | int  | "                                                                     |
| `non_idolized_maximum_statistics_smile` | int  | "                                                                     |
| `rarity`                                | str  |                                                                       |
| `release_date`                          | str  | not verified                                                          |
| `skill`                                 | str  | name autogenerated from type, except when it's a shared R/promo skill |
| `skill_details`                         | str  | autogenerated from parameters, sometimes picky about decimals         |

### Caveats

- Not cwd-safe. cd into the repository before running anything.
- Use Python 3, preferably 3.5+.
- The tools do not perform decryption, nor do they perform extraction.
  Please decrypt and extract your cache before running tools against it.
  - Extracting from your own cache? Make sure you're in full download mode.
    - Due to KLab shenanigans, full download mode has no effect on EN. Use JP.
  - Ask about luckylucky if you are too lazy.
- The cwd needs to be writable (for gen_images).
